generator client {
  provider        = "prisma-client-js"
  previewFeatures = []
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                        String                     @id @default(uuid())
  name                      String
  slug                      String                     @unique
  plan                      PlanType                   @default(BASIC)
  isActive                  Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  banks                     Bank[]
  customers                 CreditCustomer[]
  fuels                     Fuel[]
  shopProducts              ShopProduct[]
  stations                  Station[]
  subscription              Subscription?
  users                     User[]
  shifts                    Shift[]
  shiftAssignments          ShiftAssignment[]
  auditLogs                 AuditLog[]
  expenses                  Expense[]
  deposits                  Deposit[]
  tanks                     Tank[]
  tankDips                  TankDip[]
  deliveries                Delivery[]
  pumpers                   Pumper[]
  officeStaff               OfficeStaff[]
  pumps                     Pump[]
  nozzles                   Nozzle[]
  prices                    Price[]
  safes                     Safe[]
  safeTransactions          SafeTransaction[]
  bankTransactions          BankTransaction[]
  notifications             Notification[]
  meterAudits               MeterAudit[]
  testPours                 TestPour[]
  oilSales                  OilSale[]
  tenders                   Tender[]
  cheques                   Cheque[]
  creditSales               CreditSale[]
  creditPayments            CreditPayment[]
  salaryPayments            SalaryPayment[]
  officeStaffSalaryPayments OfficeStaffSalaryPayment[]
  pumperLoans               LoanPumper[]
  officeStaffLoans          LoanOfficeStaff[]
  externalLoans             LoanExternal[]
  shiftTemplates            ShiftTemplate[]
  posTerminals              PosTerminal[]
  posBatches                PosBatch[]
  posBatchEntries           PosBatchTerminalEntry[]
  posMissingSlips           PosMissingSlip[]
  shopPurchaseBatches       ShopPurchaseBatch[]
  shopAssignments           ShopAssignment[]
  shopShiftItems            ShopShiftItem[]
  shopSales                 ShopSale[]
  shopWastages              ShopWastage[]
  subscriptionPayments      SubscriptionPayment[]

  @@index([slug])
}

model Subscription {
  id               String             @id @default(uuid())
  organizationId   String             @unique
  planId           PlanType           @default(BASIC)
  status           SubscriptionStatus @default(ACTIVE)
  amount           Float              @default(0)
  currency         String             @default("LKR")
  billingInterval  BillingInterval    @default(MONTH)
  maxStations      Int                @default(1)
  paidStations     Int                @default(0)
  trialEndDate     DateTime?
  nextBillingDate  DateTime?
  cancelledAt      DateTime?
  stripeCustomerId String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  organization     Organization       @relation(fields: [organizationId], references: [id])
}

model SubscriptionPayment {
  id                    String          @id @default(uuid())
  organizationId        String
  amount                Float
  currency              String          @default("LKR")
  status                PaymentStatus   @default(PENDING)
  provider              PaymentProvider
  providerTransactionId String?
  billingDate           DateTime        @default(now())
  receiptUrl            String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  organization          Organization    @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([providerTransactionId])
}

model User {
  id             String        @id @default(uuid())
  username       String        @unique
  email          String        @unique
  password       String
  role           UserRole      @default(MANAGER)
  stationId      String?
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  lastLogin      DateTime?
  failedAttempts Int           @default(0)
  isFirstLogin   Boolean       @default(true)
  lockoutUntil   DateTime?
  mfaEnabled     Boolean       @default(false)
  mfaSecret      String?
  organizationId String?
  auditLogs      AuditLog[]
  organization   Organization? @relation(fields: [organizationId], references: [id])
  station        Station?      @relation(fields: [stationId], references: [id])

  @@unique([id, organizationId])
  @@index([username])
  @@index([email])
  @@index([stationId])
  @@index([organizationId])
}

model Station {
  id                        String                     @id @default(uuid())
  name                      String
  address                   String
  city                      String
  isActive                  Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  email                     String?
  openingHours              String?
  phone                     String?
  organizationId            String?
  bankTransactions          BankTransaction[]
  cheques                   Cheque[]
  deliveries                Delivery[]
  deposits                  Deposit[]
  expenses                  Expense[]
  externalLoans             LoanExternal[]
  officeStaffLoans          LoanOfficeStaff[]
  pumperLoans               LoanPumper[]
  notifications             Notification[]
  officeStaff               OfficeStaff[]
  officeStaffSalaryPayments OfficeStaffSalaryPayment[]
  oilSales                  OilSale[]
  posTerminals              PosTerminal[]
  prices                    Price[]
  pumps                     Pump[]
  pumpers                   Pumper[]
  safe                      Safe?
  salaryPayments            SalaryPayment[]
  shifts                    Shift[]
  shiftTemplates            ShiftTemplate[]
  shopProducts              ShopProduct[]
  organization              Organization?              @relation(fields: [organizationId], references: [id])
  tanks                     Tank[]
  tankDips                  TankDip[]
  users                     User[]

  @@unique([id, organizationId])
  @@index([isActive])
  @@index([organizationId])
}

model Shift {
  id              String            @id @default(uuid())
  stationId       String
  templateId      String?
  startTime       DateTime
  endTime         DateTime?
  status          ShiftStatus       @default(OPEN)
  openedBy        String
  closedBy        String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  statistics      Json?
  declaredAmounts Json?
  creditSales     CreditSale[]
  meterAudits     MeterAudit[]
  posBatches      PosBatch[]
  posMissingSlips PosMissingSlip[]
  station         Station           @relation(fields: [stationId], references: [id])
  template        ShiftTemplate?    @relation(fields: [templateId], references: [id])
  assignments     ShiftAssignment[]
  shopAssignment  ShopAssignment?
  tenders         Tender[]
  testPours       TestPour[]
  organizationId  String?
  organization    Organization?     @relation(fields: [organizationId], references: [id])
  shiftNumber     String?

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([status])
  @@index([startTime])
  @@index([stationId, status])
  @@index([status, createdAt])
  @@index([organizationId])
}

model ShiftTemplate {
  id             String        @id @default(uuid())
  stationId      String
  name           String
  startTime      String
  endTime        String
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  breakDuration  Int           @default(0)
  breakStartTime String?
  description    String?
  icon           String?       @default("sun")
  shifts         Shift[]
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([organizationId])
}

model ShiftAssignment {
  id                String           @id @default(uuid())
  shiftId           String
  nozzleId          String
  pumperName        String
  startMeterReading Float
  endMeterReading   Float?
  status            AssignmentStatus @default(ACTIVE)
  assignedAt        DateTime         @default(now())
  closedAt          DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  nozzle            Nozzle           @relation(fields: [nozzleId], references: [id])
  shift             Shift            @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  organizationId    String?
  organization      Organization?    @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([shiftId])
  @@index([nozzleId])
  @@index([status])
  @@index([shiftId, status])
  @@index([organizationId])
}

model Tank {
  id             String        @id @default(uuid())
  stationId      String
  capacity       Float
  currentLevel   Float
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  tankNumber     String        @default("TANK-1")
  fuelId         String
  deliveries     Delivery[]
  nozzles        Nozzle[]
  fuel           Fuel          @relation(fields: [fuelId], references: [id])
  station        Station       @relation(fields: [stationId], references: [id])
  tankDips       TankDip[]
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([stationId, tankNumber])
  @@unique([id, organizationId])
  @@index([stationId])
  @@index([fuelId])
  @@index([stationId, isActive])
  @@index([currentLevel])
  @@index([organizationId])
}

model Fuel {
  id             String        @id @default(uuid())
  code           String
  name           String
  category       String
  description    String?
  icon           String?
  isActive       Boolean       @default(true)
  sortOrder      Int           @default(0)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])
  prices         Price[]
  tanks          Tank[]

  @@unique([code, organizationId])
  @@unique([id, organizationId])
  @@index([code])
  @@index([category])
  @@index([isActive])
  @@index([organizationId])
}

model Pump {
  id             String        @id @default(uuid())
  stationId      String
  pumpNumber     String
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  nozzles        Nozzle[]
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([stationId, pumpNumber])
  @@unique([id, organizationId])
  @@index([stationId])
  @@index([stationId, isActive])
  @@index([organizationId])
}

model Nozzle {
  id                String            @id @default(uuid())
  pumpId            String
  tankId            String
  nozzleNumber      String
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  meterMax          Float?
  rolloverThreshold Float?
  meterAudits       MeterAudit[]
  pump              Pump              @relation(fields: [pumpId], references: [id], onDelete: Cascade)
  tank              Tank              @relation(fields: [tankId], references: [id])
  assignments       ShiftAssignment[]
  testPours         TestPour[]
  organizationId    String?
  organization      Organization?     @relation(fields: [organizationId], references: [id])

  @@unique([pumpId, nozzleNumber])
  @@unique([id, organizationId])
  @@index([tankId])
  @@index([pumpId, isActive])
  @@index([organizationId])
}

model TankDip {
  id             String        @id @default(uuid())
  stationId      String
  tankId         String
  reading        Float
  recordedBy     String
  dipDate        DateTime
  notes          String?
  bookStock      Float?   // System stock level at the time of dip measurement
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  station        Station       @relation(fields: [stationId], references: [id])
  tank           Tank          @relation(fields: [tankId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([tankId])
  @@index([dipDate])
  @@index([organizationId])
}

model Delivery {
  id                  String         @id @default(uuid())
  stationId           String
  tankId              String
  quantity            Float
  supplier            String
  deliveryDate        DateTime
  receivedBy          String
  invoiceNumber       String?
  notes               String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  invoiceQuantity     Float?
  actualReceived      Float?
  afterDipReading     Float?
  afterDipTime        DateTime?
  beforeDipReading    Float?
  beforeDipTime       DateTime?
  fuelSoldDuring      Float?
  verificationStatus  DeliveryStatus        @default(PENDING_VERIFICATION)
  status              DeliveryStatus        @default(PENDING_VERIFICATION)
  paymentStatus       DeliveryPaymentStatus @default(UNPAID)
  costPrice           Float?
  totalCost           Float?
  waterLevelBefore    Float?
  waterLevelAfter     Float?
  afterMeterReadings  Json?
  
  chequeId            String?
  cheque              Cheque?               @relation(fields: [chequeId], references: [id])

  verifiedAt          DateTime?
  verifiedBy          String?
  beforeMeterReadings Json?
  station             Station               @relation(fields: [stationId], references: [id])
  tank                Tank                  @relation(fields: [tankId], references: [id])
  organizationId      String?
  organization        Organization?         @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([tankId])
  @@index([deliveryDate])
  @@index([verificationStatus])
  @@index([organizationId])
  @@index([paymentStatus])
  @@index([chequeId])
}

model Expense {
  id             String        @id @default(uuid())
  stationId      String
  category       String
  description    String
  amount         Float
  fromSafe       Boolean       @default(false)
  paidBy         String
  proof          String?
  expenseDate    DateTime
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  recordedBy     String        @default("System")
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([expenseDate])
  @@index([category])
  @@index([organizationId])
}

model Deposit {
  id             String        @id @default(uuid())
  stationId      String
  amount         Float
  bankId         String
  accountId      String
  depositSlip    String?
  depositedBy    String
  depositDate    DateTime
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  bank           Bank          @relation(fields: [bankId], references: [id])
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([bankId])
  @@index([depositDate])
  @@index([organizationId])
}

model LoanExternal {
  id             String        @id @default(uuid())
  stationId      String
  borrowerName   String
  borrowerPhone  String
  amount         Float
  interestRate   Float?
  dueDate        DateTime
  status         LoanStatus    @default(ACTIVE)
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([status])
  @@index([dueDate])
  @@index([organizationId])
}

model LoanPumper {
  id             String        @id @default(uuid())
  stationId      String
  pumperName     String
  amount         Float
  reason         String
  dueDate        DateTime
  status         LoanStatus    @default(ACTIVE)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  monthlyRental  Float?        @default(0)
  givenBy        String?
  paidAmount     Float         @default(0)
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([status])
  @@index([dueDate])
  @@index([stationId, status])
  @@index([status, createdAt])
  @@index([organizationId])
}

model LoanOfficeStaff {
  id             String        @id @default(uuid())
  stationId      String
  staffName      String
  amount         Float
  paidAmount     Float         @default(0)
  monthlyRental  Float?        @default(0)
  reason         String
  givenBy        String?
  dueDate        DateTime
  status         LoanStatus    @default(ACTIVE)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([status])
  @@index([dueDate])
  @@index([organizationId])
}

model Cheque {
  id              String           @id @default(uuid())
  stationId       String
  chequeNumber    String           @unique
  amount          Float
  bankId          String
  receivedFrom    String
  receivedDate    DateTime
  status          ChequeStatus     @default(PENDING)
  clearedDate     DateTime?
  notes           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  recordedBy      String           @default("System")
  chequeDate      DateTime         @default(now())
  creditPaymentId String?          @unique
  depositDate     DateTime?
  organizationId  String?
  organization    Organization?    @relation(fields: [organizationId], references: [id])
  bankTransaction BankTransaction?
  bank            Bank             @relation(fields: [bankId], references: [id])
  creditPayment   CreditPayment?   @relation(fields: [creditPaymentId], references: [id])
  station         Station          @relation(fields: [stationId], references: [id])
  deliveries      Delivery[]

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([bankId])
  @@index([status])
  @@index([receivedDate])
  @@index([chequeDate])
  @@index([organizationId])
}

model CreditCustomer {
  id             String          @id @default(uuid())
  name           String
  company        String?
  address        String
  phone          String
  email          String?
  creditLimit    Float           @default(0)
  currentBalance Float           @default(0)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  organizationId String?
  organization   Organization?   @relation(fields: [organizationId], references: [id])
  creditPayments CreditPayment[]
  creditSales    CreditSale[]

  @@unique([id, organizationId])
  @@index([phone])
  @@index([isActive])
  @@index([organizationId])
}

model CreditSale {
  id             String         @id @default(uuid())
  customerId     String
  shiftId        String
  nozzleId       String
  amount         Float
  liters         Float
  price          Float
  slipPhoto      String?
  signedBy       String
  timestamp      DateTime
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  recordedBy     String         @default("System")
  customer       CreditCustomer @relation(fields: [customerId], references: [id])
  shift          Shift          @relation(fields: [shiftId], references: [id])
  organizationId String?
  organization   Organization?  @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([customerId])
  @@index([shiftId])
  @@index([timestamp])
  @@index([organizationId])
}

model CreditPayment {
  id              String              @id @default(uuid())
  customerId      String
  amount          Float
  paymentType     PaymentType
  chequeNumber    String?
  bankId          String?
  paymentDate     DateTime
  receivedBy      String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  referenceNumber String?
  status          CreditPaymentStatus @default(CLEARED)
  cheque          Cheque?
  bank            Bank?               @relation(fields: [bankId], references: [id])
  customer        CreditCustomer      @relation(fields: [customerId], references: [id])
  organizationId  String?
  organization    Organization?       @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([customerId])
  @@index([paymentDate])
  @@index([organizationId])
}

model PosTerminal {
  id             String                  @id @default(uuid())
  stationId      String
  terminalNumber String
  name           String
  isActive       Boolean                 @default(true)
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  bankId         String?
  batchEntries   PosBatchTerminalEntry[]
  missingSlips   PosMissingSlip[]
  bank           Bank?                   @relation(fields: [bankId], references: [id])
  station        Station                 @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization?           @relation(fields: [organizationId], references: [id])

  @@unique([stationId, terminalNumber])
  @@unique([id, organizationId])
  @@index([stationId])
  @@index([bankId])
  @@index([organizationId])
}

model PosBatch {
  id              String                  @id @default(uuid())
  shiftId         String
  totalAmount     Float
  isReconciled    Boolean                 @default(false)
  reconciledBy    String?
  reconciledAt    DateTime?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  notes           String?
  shift           Shift                   @relation(fields: [shiftId], references: [id])
  terminalEntries PosBatchTerminalEntry[]
  organizationId  String?
  organization    Organization?           @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([shiftId])
  @@index([isReconciled])
  @@index([organizationId])
}

model PosBatchTerminalEntry {
  id                String        @id @default(uuid())
  batchId           String
  terminalId        String
  startNumber       String
  endNumber         String
  transactionCount  Int
  visaAmount        Float         @default(0)
  masterAmount      Float         @default(0)
  amexAmount        Float         @default(0)
  qrAmount          Float         @default(0)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  dialogTouchAmount Float         @default(0)
  batch             PosBatch      @relation(fields: [batchId], references: [id], onDelete: Cascade)
  terminal          PosTerminal   @relation(fields: [terminalId], references: [id])
  organizationId    String?
  organization      Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([batchId])
  @@index([terminalId])
  @@index([organizationId])
}

model PosMissingSlip {
  id             String        @id @default(uuid())
  terminalId     String
  shiftId        String
  amount         Float
  lastFourDigits String
  timestamp      DateTime
  reportedBy     String
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  shift          Shift         @relation(fields: [shiftId], references: [id])
  terminal       PosTerminal   @relation(fields: [terminalId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([terminalId])
  @@index([shiftId])
  @@index([timestamp])
  @@index([organizationId])
}

model Safe {
  id             String            @id @default(uuid())
  stationId      String            @unique
  openingBalance Float             @default(0)
  currentBalance Float             @default(0)
  lastCounted    DateTime?
  countedBy      String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  station        Station           @relation(fields: [stationId], references: [id])
  transactions   SafeTransaction[]
  organizationId String?
  organization   Organization?     @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([organizationId])
}

model SafeTransaction {
  id             String              @id @default(uuid())
  safeId         String
  type           SafeTransactionType
  amount         Float
  balanceBefore  Float
  balanceAfter   Float
  shiftId        String?
  batchId        String?
  creditSaleId   String?
  chequeId       String?
  expenseId      String?
  loanId         String?
  depositId      String?
  description    String
  performedBy    String
  timestamp      DateTime
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  safe           Safe                @relation(fields: [safeId], references: [id], onDelete: Cascade)
  organizationId String?
  organization   Organization?       @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([safeId])
  @@index([type])
  @@index([timestamp])
  @@index([safeId, timestamp])
  @@index([shiftId])
  @@index([organizationId])
}

model Price {
  id             String        @id @default(uuid())
  stationId      String
  price          Float
  effectiveDate  DateTime
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  fuelId         String
  updatedBy      String        @default("System")
  fuel           Fuel          @relation(fields: [fuelId], references: [id])
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([fuelId])
  @@index([effectiveDate])
  @@index([isActive])
  @@index([organizationId])
}

model Bank {
  id               String            @id @default(uuid())
  name             String
  branch           String?
  accountNumber    String?
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  accountName      String?
  code             String?
  contactPerson    String?
  email            String?
  phone            String?
  swiftCode        String?
  organizationId   String?
  organization     Organization?     @relation(fields: [organizationId], references: [id])
  bankTransactions BankTransaction[]
  cheques          Cheque[]
  creditPayments   CreditPayment[]
  deposits         Deposit[]
  posTerminals     PosTerminal[]

  @@unique([id, organizationId])
  @@index([isActive])
  @@index([organizationId])
}

model BankTransaction {
  id              String              @id @default(uuid())
  bankId          String
  stationId       String?
  type            BankTransactionType
  amount          Float
  description     String
  referenceNumber String?
  transactionDate DateTime
  createdBy       String
  notes           String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  chequeId        String?             @unique
  bank            Bank                @relation(fields: [bankId], references: [id])
  cheque          Cheque?             @relation(fields: [chequeId], references: [id])
  station         Station?            @relation(fields: [stationId], references: [id])
  organizationId  String?
  organization    Organization?       @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([bankId])
  @@index([stationId])
  @@index([transactionDate])
  @@index([type])
  @@index([organizationId])
}

model Pumper {
  id               String          @id @default(uuid())
  name             String
  phone            String?
  isActive         Boolean         @default(true)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  employeeId       String?
  experience       Float?
  hireDate         DateTime?
  rating           Float?
  shift            PumperShift     @default(ANY)
  specializations  String[]        @default([])
  stationId        String?
  status           PumperStatus    @default(ACTIVE)
  baseSalary       Float?          @default(0)
  holidayAllowance Float?          @default(4500)
  advanceLimit     Float?          @default(50000)
  station          Station?        @relation(fields: [stationId], references: [id])
  salaryPayments   SalaryPayment[]
  organizationId   String?
  organization     Organization?   @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([status])
  @@index([isActive])
  @@index([stationId, isActive])
  @@index([organizationId])
}

model OfficeStaff {
  id               String                     @id @default(uuid())
  name             String
  employeeId       String?
  stationId        String
  role             OfficeStaffRole            @default(MANAGER)
  phone            String?
  email            String?
  baseSalary       Float                      @default(0)
  isActive         Boolean                    @default(true)
  hireDate         DateTime?
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt
  fuelAllowance    Float                      @default(0)
  holidayAllowance Float                      @default(0)
  medicalAllowance Float                      @default(0)
  otherAllowances  Float                      @default(0)
  specialAllowance Float                      @default(0)
  station          Station                    @relation(fields: [stationId], references: [id])
  salaryPayments   OfficeStaffSalaryPayment[]
  organizationId   String?
  organization     Organization?              @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([role])
  @@index([isActive])
  @@index([organizationId])
}

model SalaryPayment {
  id               String              @id @default(uuid())
  stationId        String
  pumperId         String
  paymentMonth     String
  baseSalary       Float               @default(0)
  varianceAdd      Float               @default(0)
  varianceDeduct   Float               @default(0)
  advances         Float               @default(0)
  loans            Float               @default(0)
  netSalary        Float
  paymentDate      DateTime
  paymentMethod    PaymentType         @default(CASH)
  paymentReference String?
  paidBy           String
  notes            String?
  status           SalaryPaymentStatus @default(PENDING)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  pumper           Pumper              @relation(fields: [pumperId], references: [id])
  station          Station             @relation(fields: [stationId], references: [id])
  organizationId   String?
  organization     Organization?       @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([pumperId])
  @@index([paymentMonth])
  @@index([paymentDate])
  @@index([status])
  @@index([organizationId])
}

model OfficeStaffSalaryPayment {
  id               String              @id @default(uuid())
  stationId        String
  officeStaffId    String
  paymentMonth     String
  baseSalary       Float               @default(0)
  advances         Float               @default(0)
  loans            Float               @default(0)
  deductions       Float               @default(0)
  netSalary        Float
  paymentDate      DateTime?
  paymentMethod    PaymentType         @default(CASH)
  paymentReference String?
  paidBy           String?
  notes            String?
  status           SalaryPaymentStatus @default(PENDING)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  officeStaff      OfficeStaff         @relation(fields: [officeStaffId], references: [id])
  station          Station             @relation(fields: [stationId], references: [id])
  organizationId   String?
  organization     Organization?       @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([officeStaffId])
  @@index([paymentMonth])
  @@index([paymentDate])
  @@index([status])
  @@index([organizationId])
}

model MeterAudit {
  id              String        @id @default(uuid())
  shiftId         String?
  nozzleId        String
  reading         Float
  meterReading    Float
  previousReading Float
  deltaLitres     Float
  variance        Float?
  status          AuditStatus?
  timestamp       DateTime
  auditTime       DateTime
  auditedBy       String
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  nozzle          Nozzle        @relation(fields: [nozzleId], references: [id])
  shift           Shift?        @relation(fields: [shiftId], references: [id])
  organizationId  String?
  organization    Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([shiftId])
  @@index([nozzleId])
  @@index([timestamp])
  @@index([organizationId])
}

model TestPour {
  id             String        @id @default(uuid())
  shiftId        String
  nozzleId       String
  amount         Float
  testType       TestPourType
  timestamp      DateTime
  performedBy    String
  returned       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  notes          String?
  nozzle         Nozzle        @relation(fields: [nozzleId], references: [id])
  shift          Shift         @relation(fields: [shiftId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([shiftId])
  @@index([nozzleId])
  @@index([organizationId])
}

model OilSale {
  id             String        @id @default(uuid())
  stationId      String
  productName    String
  quantity       Float
  unit           String        @default("liters")
  price          Float
  totalAmount    Float
  customerName   String?
  saleDate       DateTime
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  recordedBy     String        @default("System")
  station        Station       @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([saleDate])
  @@index([organizationId])
}

model Tender {
  id             String        @id @default(uuid())
  shiftId        String
  amount         Float
  tenderType     String
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  shift          Shift         @relation(fields: [shiftId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([shiftId])
  @@index([organizationId])
}

model AuditLog {
  id             String        @id @default(uuid())
  userId         String
  userName       String
  userRole       UserRole
  action         AuditAction
  entity         String
  entityId       String?
  details        String
  ipAddress      String?
  stationId      String?
  stationName    String?
  timestamp      DateTime      @default(now())
  createdAt      DateTime      @default(now())
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])
  user           User          @relation(fields: [userId], references: [id])

  @@unique([id, organizationId])
  @@index([organizationId])
  @@index([userId])
  @@index([entity])
  @@index([action])
  @@index([timestamp])
  @@index([stationId])
}

model Notification {
  id             String               @id @default(uuid())
  stationId      String?
  title          String
  message        String
  type           NotificationType
  priority       NotificationPriority @default(MEDIUM)
  category       NotificationCategory
  isRead         Boolean              @default(false)
  actionUrl      String?
  metadata       Json?
  createdAt      DateTime             @default(now())
  readAt         DateTime?
  station        Station?             @relation(fields: [stationId], references: [id])
  organizationId String?
  organization   Organization?        @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([isRead])
  @@index([type])
  @@index([priority])
  @@index([category])
  @@index([createdAt])
  @@index([stationId, isRead])
  @@index([isRead, createdAt])
  @@index([organizationId])
}

model ShopProduct {
  id             String              @id @default(uuid())
  stationId      String
  name           String
  category       String?
  unit           String              @default("piece")
  sellingPrice   Float
  reorderLevel   Float               @default(5)
  isActive       Boolean             @default(true)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  organizationId String?
  organization   Organization?       @relation(fields: [organizationId], references: [id])
  station        Station             @relation(fields: [stationId], references: [id])
  batches        ShopPurchaseBatch[]
  sales          ShopSale[]
  shiftItems     ShopShiftItem[]
  wastage        ShopWastage[]

  @@unique([id, organizationId])
  @@index([stationId])
  @@index([organizationId])
}

model ShopPurchaseBatch {
  id               String        @id @default(uuid())
  productId        String
  costPrice        Float
  originalQuantity Float
  currentQuantity  Float
  expiryDate       DateTime?
  purchaseDate     DateTime      @default(now())
  supplierId       String?
  recordedBy       String
  createdAt        DateTime      @default(now())
  product          ShopProduct   @relation(fields: [productId], references: [id])
  sales            ShopSale[]
  organizationId   String?
  organization     Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([productId])
  @@index([organizationId])
}

model ShopAssignment {
  id             String          @id @default(uuid())
  shiftId        String          @unique
  pumperId       String
  pumperName     String
  status         String          @default("OPEN")
  totalRevenue   Float           @default(0)
  totalShortage  Float           @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  shift          Shift           @relation(fields: [shiftId], references: [id])
  sales          ShopSale[]
  items          ShopShiftItem[]
  organizationId String?
  organization   Organization?   @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@unique([shiftId, organizationId])
  @@index([organizationId])
}

model ShopShiftItem {
  id             String         @id @default(uuid())
  assignmentId   String
  productId      String
  openingStock   Float
  addedStock     Float          @default(0)
  closingStock   Float?
  soldQuantity   Float          @default(0)
  revenue        Float          @default(0)
  assignment     ShopAssignment @relation(fields: [assignmentId], references: [id])
  product        ShopProduct    @relation(fields: [productId], references: [id])
  organizationId String?
  organization   Organization?  @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([assignmentId])
  @@index([productId])
  @@index([organizationId])
}

model ShopSale {
  id             String             @id @default(uuid())
  assignmentId   String
  productId      String
  batchId        String?
  quantity       Float
  unitPrice      Float
  totalAmount    Float
  costPrice      Float
  timestamp      DateTime           @default(now())
  assignment     ShopAssignment     @relation(fields: [assignmentId], references: [id])
  batch          ShopPurchaseBatch? @relation(fields: [batchId], references: [id])
  product        ShopProduct        @relation(fields: [productId], references: [id])
  organizationId String?
  organization   Organization?      @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([assignmentId])
  @@index([productId])
  @@index([organizationId])
}

model ShopWastage {
  id             String        @id @default(uuid())
  productId      String
  quantity       Float
  reason         String
  costPrice      Float
  recordedBy     String
  timestamp      DateTime      @default(now())
  product        ShopProduct   @relation(fields: [productId], references: [id])
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([id, organizationId])
  @@index([productId])
  @@index([organizationId])
}

enum PlanType {
  BASIC
  PREMIUM
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELLED
  UNPAID
  TRIALING
}

enum BillingInterval {
  MONTH
  YEAR
}

enum PaymentStatus {
  SUCCESS
  FAILED
  PENDING
  REFUNDED
}

enum PaymentProvider {
  STRIPE
  PAYHERE
  MANUAL
}

enum UserRole {
  OWNER
  MANAGER
  ACCOUNTS
  DEVELOPER
}

enum ShiftStatus {
  OPEN
  CLOSED
}

enum AssignmentStatus {
  ACTIVE
  CLOSED
}

enum DeliveryStatus {
  PROCESSING
  PENDING_VERIFICATION
  VERIFIED
  DISCREPANCY
}

enum DeliveryPaymentStatus {
  PAID
  UNPAID
  PARTIAL
}

enum LoanStatus {
  ACTIVE
  PAID
  OVERDUE
}

enum ChequeStatus {
  PENDING
  CLEARED
  BOUNCED
  CANCELLED
  DEPOSITED
}

enum PaymentType {
  CASH
  CHEQUE
  BANK_TRANSFER
}

enum CreditPaymentStatus {
  PENDING
  CLEARED
  BOUNCED
  DEPOSITED
}

enum SafeTransactionType {
  CASH_FUEL_SALES
  POS_CARD_PAYMENT
  CREDIT_PAYMENT
  CHEQUE_RECEIVED
  LOAN_REPAID
  EXPENSE
  LOAN_GIVEN
  BANK_DEPOSIT
  CASH_TRANSFER
  COUNT_ADJUSTMENT
  OPENING_BALANCE
  FUEL_DELIVERY_PAYMENT
}

enum BankTransactionType {
  DEPOSIT
  WITHDRAWAL
  TRANSFER_IN
  TRANSFER_OUT
  FEE
  INTEREST
  ADJUSTMENT
}

enum PumperStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
}

enum PumperShift {
  MORNING
  EVENING
  NIGHT
  ANY
}

enum OfficeStaffRole {
  MANAGER
  SUPERVISOR
  OFFICE_STAFF
  ACCOUNTANT
  CASHIER
}

enum SalaryPaymentStatus {
  PENDING
  PAID
  PARTIAL
  CANCELLED
}

enum AuditStatus {
  NORMAL
  WARNING
  CRITICAL
}

enum TestPourType {
  L5
  L50
  L100
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  VIEW
  LOGIN
  LOGOUT
  OPEN
  CLOSE
  APPROVE
  REJECT
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum NotificationCategory {
  SYSTEM
  OPERATIONS
  FINANCIAL
  MAINTENANCE
  TANK
  SHIFT
  CREDIT
  POS
  DELIVERY
}
